/*1345599518,173220391*/

if (window.CavalryLogger) { CavalryLogger.start_js(["b+TVu"]); }

__d("PluginPerms",["DOMEvent","DOMEventListener","PopupWindow","URI","bind","copyProperties"],function(a,b,c,d,e,f){var g=b('DOMEvent'),h=b('DOMEventListener'),i=b('PopupWindow'),j=b('URI'),k=b('bind'),l=b('copyProperties');function m(n,o){l(this,{return_params:j.getRequestURI().getQueryData(),login_params:{},perms_params:{},perms:[],plugin:n,app:o});this.addReturnParams({ret:'perms'});delete this.return_params.hash;}l(m.prototype,{addReturnParams:function(n){l(this.return_params,n);},addLoginParams:function(n){l(this.login_params,n);},addPermsParams:function(n){l(this.perms_params,n);},addPerms:function(n){this.perms.push.apply(this.perms,n);},start:function(){var n=j('/dialog/plugin.perms').addQueryData(this.perms_params).addQueryData({display:'popup',app_id:this.app,perms:this.perms.join(','),secure:j.getRequestURI().isSecure(),social_plugin:this.plugin,return_params:JSON.stringify(this.return_params),login_params:JSON.stringify(this.login_params)});this.popup=i.open(n.toString(),210,450);h.add(window,'message',function(event){if((/\.facebook\.com$/).test(event.origin))if(/^FB_POPUP:/.test(event.data)){var o=JSON.parse(event.data.substring(9));if('reload' in o)document.location.replace(o.reload);}});}});m.starter=function(n,o,p,q,r,s){var t=new m(n,o);t.addReturnParams(q||{});t.addLoginParams(r||{});t.addPermsParams(s||{});t.addPerms(p||[]);return k(t,t.start);};m.listen=function(n,o,p,q,r,s,t){h.add(n,'click',function(u){new g(u).kill();m.starter(o,p,q,r,s,t)();});};e.exports=m;});
__d("legacy:PluginStack-legacy",["Plugin","PluginStack"],function(a,b,c,d){if(!a.Plugin||!a.Plugin.CONNECT)a.Plugin=b('Plugin');a.Plugin.Stack=b('PluginStack');},3);